<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Moncli - An introduction</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Jelle Smet">

    <!-- Le styles -->
    <link rel="stylesheet" href="http://smetj.net/theme/css/bootstrap.min.css" type="text/css" />
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
      .tag-1 {
        font-size: 13pt;
      }
      .tag-2 {
        font-size: 10pt;
      }
      .tag-2 {
        font-size: 8pt;
      }
      .tag-4 {
        font-size: 6pt;
     }
    </style>
    <link href="http://smetj.net/theme/css/bootstrap-responsive.min.css" rel="stylesheet">
        <link href="http://smetj.net/theme/css/font-awesome.css" rel="stylesheet">

    <link href="http://smetj.net/theme/css/pygments.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="http://smetj.net/theme/images/favicon.ico">
    <link rel="apple-touch-icon" href="http://smetj.net/theme/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="http://smetj.net/theme/images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="http://smetj.net/theme/images/apple-touch-icon-114x114.png">

    <link href="http://smetj.net/" type="application/atom+xml" rel="alternate" title="Project site of Jelle Smet ATOM Feed" />

  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="http://smetj.net/index.html">Project site of Jelle Smet </a>
          <div class="nav-collapse">
            <ul class="nav">
                          <li class="divider-vertical"></li>
                  <li >
                    <a href="http://smetj.net/category/development.html">
						<i class="icon-folder-open icon-large"></i>development
					</a>
                  </li>
                  <li >
                    <a href="http://smetj.net/category/engineering.html">
						<i class="icon-folder-open icon-large"></i>engineering
					</a>
                  </li>
                  <li >
                    <a href="http://smetj.net/category/misc.html">
						<i class="icon-folder-open icon-large"></i>misc
					</a>
                  </li>
                  <li class="active">
                    <a href="http://smetj.net/category/monitoringlove.html">
						<i class="icon-folder-open icon-large"></i>#monitoringlove
					</a>
                  </li>

                          <ul class="nav pull-right">
                                <li><a href="http://smetj.net/archives.html"><i class="icon-th-list"></i>Archives</a></li>
                          </ul>

            </ul>
            <!--<p class="navbar-text pull-right">Logged in as <a href="#">username</a></p>-->
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="row">
        <div class="span3 well sidebar-nav" id="sidebar">
<ul class="nav nav-list">
<li class="nav-header"><h4><i class="icon-home icon-large"></i> social</h4></li>
    <li><a href="http://twitter.com/smetj"><i class="icon-twitter-sign icon-large"></i>twitter</a></li>
    <li><a href="http://github.com/smetj"><i class="icon-github-sign icon-large"></i>github</a></li>

<li class="nav-header"><h4><i class="icon-folder-close icon-large"></i>Categories</h4></li>
<li>
<a href="http://smetj.net/category/development.html">
    <i class="icon-folder-open icon-large"></i>development
</a>
</li>
<li>
<a href="http://smetj.net/category/engineering.html">
    <i class="icon-folder-open icon-large"></i>engineering
</a>
</li>
<li>
<a href="http://smetj.net/category/misc.html">
    <i class="icon-folder-open icon-large"></i>misc
</a>
</li>
<li>
<a href="http://smetj.net/category/monitoringlove.html">
    <i class="icon-folder-open icon-large"></i>#monitoringlove
</a>
</li>

<li class="nav-header"><h4><i class="icon-tags icon-large"></i>Tags</h4></li>
<li class="tag-4">
    <a href="http://smetj.net/tag/company.html">
        <i class="icon-tag icon-large"></i>company
    </a>
</li>
<li class="tag-0">
    <a href="http://smetj.net/tag/monitoringlove.html">
        <i class="icon-tag icon-large"></i>monitoringlove
    </a>
</li>
<li class="tag-4">
    <a href="http://smetj.net/tag/metrics.html">
        <i class="icon-tag icon-large"></i>metrics
    </a>
</li>
<li class="tag-2">
    <a href="http://smetj.net/tag/rabbitmq.html">
        <i class="icon-tag icon-large"></i>rabbitmq
    </a>
</li>
<li class="tag-4">
    <a href="http://smetj.net/tag/krolyk.html">
        <i class="icon-tag icon-large"></i>krolyk
    </a>
</li>
<li class="tag-4">
    <a href="http://smetj.net/tag/amqp.html">
        <i class="icon-tag icon-large"></i>amqp
    </a>
</li>
<li class="tag-4">
    <a href="http://smetj.net/tag/molog.html">
        <i class="icon-tag icon-large"></i>molog
    </a>
</li>
<li class="tag-0">
    <a href="http://smetj.net/tag/moncli.html">
        <i class="icon-tag icon-large"></i>moncli
    </a>
</li>
<li class="tag-2">
    <a href="http://smetj.net/tag/monitoring.html">
        <i class="icon-tag icon-large"></i>monitoring
    </a>
</li>
<li class="tag-2">
    <a href="http://smetj.net/tag/graphite.html">
        <i class="icon-tag icon-large"></i>graphite
    </a>
</li>
<li class="tag-2">
    <a href="http://smetj.net/tag/metricfactory.html">
        <i class="icon-tag icon-large"></i>metricfactory
    </a>
</li>
<li class="tag-4">
    <a href="http://smetj.net/tag/events.html">
        <i class="icon-tag icon-large"></i>events
    </a>
</li>
<li class="tag-1">
    <a href="http://smetj.net/tag/python.html">
        <i class="icon-tag icon-large"></i>python
    </a>
</li>
<li class="tag-4">
    <a href="http://smetj.net/tag/messaging.html">
        <i class="icon-tag icon-large"></i>messaging
    </a>
</li>
<li class="tag-4">
    <a href="http://smetj.net/tag/pypy.html">
        <i class="icon-tag icon-large"></i>pypy
    </a>
</li>
<li class="tag-2">
    <a href="http://smetj.net/tag/wishbone.html">
        <i class="icon-tag icon-large"></i>wishbone
    </a>
</li>
<li class="tag-4">
    <a href="http://smetj.net/tag/tools.html">
        <i class="icon-tag icon-large"></i>tools
    </a>
</li>
<li class="tag-4">
    <a href="http://smetj.net/tag/gevent.html">
        <i class="icon-tag icon-large"></i>gevent
    </a>
</li>


</ul>        </div><!--/.well -->
        <div class="span9" id="content">
<section id="content">
        <article>
                <header>
                        <h1>
                                <a href=""
                                        rel="bookmark"
                                        title="Permalink to Moncli - An introduction">
                                        Moncli - An introduction
                                </a>
                        </h1>
                </header>
                <div class="entry-content">
                <div class="well">
<footer class="post-info">
<span class="label">Date</span>
<abbr class="published" title="2012-02-09T00:20:00">
        <i class="icon-calendar"></i>do 09 februari 2012
</abbr>
<span class="label">By</span>
<a href="http://smetj.net/author/smetj.html"><i class="icon-user"></i>smetj</a>
<span class="label">Category</span>
<a href="http://smetj.net/category/monitoringlove.html"><i class="icon-folder-open"></i>#monitoringlove</a>.


<span class="label">Tags</span>
	<a href="http://smetj.net/tag/moncli.html"><i class="icon-tag"></i>moncli</a>
	<a href="http://smetj.net/tag/monitoringlove.html"><i class="icon-tag"></i>monitoringlove</a>
	<a href="http://smetj.net/tag/rabbitmq.html"><i class="icon-tag"></i>rabbitmq</a>
</footer><!-- /.post-info -->                </div>
                <p><a class="reference external" href="http://smetj.net/2012/02/09/moncli-an-introduction/moncli_architecture_1-2/"><img alt="image0" src="http://smetj.net/wp-content/uploads/2012/02/Moncli_architecture_11-300x231.jpg" /></a></p>
<p>One of the classic tasks one has to deal with when working with a
monitoring framework is have the ability to retrieve metrics from an OS
or server which aren't available just like that over the network. There
are plenty of different techniques and a multitude of clients available
which offer this functionality. &nbsp;Covering them falls out of the scope of
this post.</p>
<div class="section" id="so-why-another-monitoring-client">
<h2>So why another Monitoring Client?</h2>
<p>When running into scalability problems with my Nagios setup, I realized
that the reason for this is the fact that Nagios always has to take the
initiative to poll a client. &nbsp;This is in Nagios terminology called an
active check. &nbsp;It's of course normal that a client receives instructions
on what it needs to do like which plugin to execute or which thresholds
to evaluate. &nbsp;However, if you think about it, why do we have to repeat
the same question over and over again while in essence nothing has ever
changed between the current and the previous request? Isn't it normal we
ask a question once and say report back at this interval and carry on
until further notice?</p>
<p>So why not offloading all (or most of) the scheduling effort a central
monitoring system has to perform to the monitoring clients running on
your hosts?</p>
<p>If you would take it further, you could turn each of my monitoring
clients into an &quot;independent miniature monitoring engine&quot;. &nbsp;This way you
could shift the load from a central system to the collective of clients
in the network. &nbsp;This basically results in horizontal scalability and a
decentralized setup.</p>
</div>
<div class="section" id="requirements">
<h2>Requirements</h2>
<div class="section" id="open-and-rich-data-format">
<h3>Open and rich data format</h3>
<p>All in- and outgoing communication should be done in an clear and open
data format, which offers the flexibility to transform it into any
other&nbsp;desirable format which allows you to integrate the client with an
existing&nbsp;platform but which in its turn also allows you to move away
from it. &nbsp;All <a class="reference external" href="http://wiki.smetj.net/wiki/Moncli_documentation#Request">incoming</a>&nbsp;to and <a class="reference external" href="http://wiki.smetj.net/wiki/Moncli_documentation#Reports">outgoing</a>&nbsp;data from Moncli is in JSON
format. This makes sure that Moncli data is manipulated easily.</p>
</div>
<div class="section" id="scheduling">
<h3>Scheduling</h3>
<p>As said, the client needs to be able to schedule a request at an
<a class="reference external" href="http://wiki.smetj.net/wiki/Moncli_documentation#cycle">interval of choice</a>. When the client restarts, it should remember its
scheduled requests and carry on from the moment it's alive again. Moncli
has a build in scheduler which <a class="reference external" href="http://wiki.smetj.net/wiki/Moncli_documentation#cache">writes its schedule to disk</a>.</p>
</div>
<div class="section" id="flexible-messaging">
<h3>Flexible messaging.</h3>
<p>Since Moncli has its own scheduler, it has to submit the check results
somehow in a trustworthy way without actually having to care much about
who consumes the data when and where. Moncli submits check results into
the <a class="reference external" href="http://www.rabbitmq.com/">RabbitMQ</a> message broker, which offers a great deal of
flexibility.</p>
<p>Moncli <a class="reference external" href="http://wiki.smetj.net/wiki/Moncli_documentation#Communication">listens</a> on the message broker infrastructure for incoming
requests. Each Moncli client registers a queue using its FQDN as a name
on the message broker infrastructure from where it receives the requests
it should execute.</p>
</div>
<div class="section" id="simple-manageable-but-safe-plugin-design">
<h3>Simple, manageable but safe plugin design</h3>
<p>Metrics have to come from somewhere. When Moncli executes a request, it
actually executes a locally stored plugin. <a class="reference external" href="http://wiki.smetj.net/wiki/Moncli_documentation#Plugins">All this plugin needs to do
is create a list of key/value pairs</a>. This significantly lowers the
difficulty and time required to create new plugins which also allows
less experienced people to write plugins. Moncli will only execute
<a class="reference external" href="http://wiki.smetj.net/wiki/Moncli_documentation#local_repo">locally stored plugins</a> which have a hash which matches the one in the
request. When a plugin with such a hash isn't found locally, it will try
to download an update or new version from <a class="reference external" href="http://wiki.smetj.net/wiki/Moncli_documentation#remote_repo">a central location</a>.</p>
</div>
<div class="section" id="evaluation-of-metrics">
<h3>Evaluation of metrics</h3>
<p>Nagios plugins require you to build in the evaluation of thresholds in
them by feeding the plugin the warning and critical values. &nbsp;Moncli also
performs the evaluation of metrics on the client side but takes another
approach. &nbsp;Instead of doing threshold evaluation in the plugin, Moncli
does the evaluation itself, based upon the <a class="reference external" href="http://wiki.smetj.net/wiki/Moncli_documentation#thresholds">thresholds</a> one provides in
combination with a an evaluator.</p>
<p>There are currently 2 <a class="reference external" href="http://wiki.smetj.net/wiki/Moncli_documentation#Evaluator_definitions">types of evaluators</a> (more planned):</p>
<p>Formulas: calculations using the keys/values returned by the plugin.
Regexes: Simple regex matching on the output of a plugin (not key
value pairs)</p>
<p>It's optional to define evaluators in a request. &nbsp;In this case, Moncli
just becomes a metrics collector.</p>
<p>A good starting point to figure out what the possibilities of Moncli are
is done by looking through &nbsp;the in- and outgoing data format of Moncli
called <a class="reference external" href="http://wiki.smetj.net/wiki/Moncli_documentation#Request">requests</a> and <a class="reference external" href="http://wiki.smetj.net/wiki/Moncli_documentation#Reports">reports</a>.</p>
<p>A second post will be about consuming and processing of Moncli data from
RabbitMQ.</p>
</div>
</div>

                </div><!-- /.entry-content -->
                <div class="comments">
		</br>
                <h2>Comments</h2>
                        <div id="disqus_thread"></div>
                        <script type="text/javascript">
                           var disqus_identifier = "moncli-an-introduction.html";
                           (function() {
                                var dsq = document.createElement('script');
                                dsq.type = 'text/javascript'; dsq.async = true;
                                dsq.src = 'http://smetj.disqus.com/embed.js';
                                (document.getElementsByTagName('head')[0] ||
                                 document.getElementsByTagName('body')[0]).appendChild(dsq);
                          })();
                        </script>
                </div>
        </article>
</section>
        </div><!--/span-->
      </div><!--/row-->

    </div><!--/.fluid-container-->


<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
	var pageTracker = _gat._getTracker("UA-40703057-1");
pageTracker._trackPageview();
} catch(err) {}</script>
<script type="text/javascript">
    var disqus_shortname = 'smetj';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

    <!-- Le javascript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="http://smetj.net/theme/js/jquery-1.7.2.min.js"></script>
    <script src="http://smetj.net/theme/js/bootstrap.min.js"></script>
  </body>
</html>