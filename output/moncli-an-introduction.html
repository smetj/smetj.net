<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">
<head>
    <title>Moncli - An introduction</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Open Graph tags -->

            <meta property="og:type" content="article"/>
            <meta property="og:title" content="Moncli - An introduction"/>
            <meta property="og:url" content="http://smetj.net/moncli-an-introduction.html"/>
            <meta property="og:description" content="One of the classic tasks one has to deal with when working with a monitoring framework is have the ability to retrieve metrics from an OS or server which aren't available just like that over the network. There are plenty of different techniques and a multitude of clients available ..."/>

    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://smetj.net/theme/css/bootstrap.flatly.min.css" type="text/css"/>
    <link href="http://smetj.net/theme/css/font-awesome.min.css" rel="stylesheet">
    <link href="http://smetj.net/theme/css/pygments.css" rel="stylesheet">
    <link rel="stylesheet" href="http://smetj.net/theme/css/style.css" type="text/css"/>
    <!-- JavaScript plugins (requires jQuery) -->
    <script src="http://code.jquery.com/jquery.js"></script>


    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-40703057-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();

    </script>
</head>
<body>
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://smetj.net" class="navbar-brand">Project site of Jelle Smet</a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                        <li >
                            <a href="http://smetj.net/category/development.html">Development</a>
                        </li>
                        <li >
                            <a href="http://smetj.net/category/engineering.html">Engineering</a>
                        </li>
                        <li >
                            <a href="http://smetj.net/category/misc.html">Misc</a>
                        </li>
                        <li class="active">
                            <a href="http://smetj.net/category/monitoringlove.html">#monitoringlove</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="http://smetj.net/archives.html"><i class="icon-th-list"></i>Archives</a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</nav>
<!-- /.navbar -->
<div class="container">
    <div class="row">
        <div class="col-lg-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://smetj.net/moncli-an-introduction.html"
                       rel="bookmark"
                       title="Permalink to Moncli - An introduction">
                        Moncli - An introduction
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="icon-calendar"></i>do 09 februari 2012
    </span>



<span class="label label-default">Tags</span>
	<a href="http://smetj.net/tag/moncli.html">moncli</a>
        /
	<a href="http://smetj.net/tag/monitoringlove.html">monitoringlove</a>
        /
	<a href="http://smetj.net/tag/rabbitmq.html">rabbitmq</a>
</footer><!-- /.post-info -->                    </div>
                </div>
                <p><a class="reference external" href="http://smetj.net/2012/02/09/moncli-an-introduction/moncli_architecture_1-2/"><img alt="image0" src="http://smetj.net/wp-content/uploads/2012/02/Moncli_architecture_11-300x231.jpg" /></a></p>
<p>One of the classic tasks one has to deal with when working with a
monitoring framework is have the ability to retrieve metrics from an OS
or server which aren't available just like that over the network. There
are plenty of different techniques and a multitude of clients available
which offer this functionality. &nbsp;Covering them falls out of the scope of
this post.</p>
<div class="section" id="so-why-another-monitoring-client">
<h2>So why another Monitoring Client?</h2>
<p>When running into scalability problems with my Nagios setup, I realized
that the reason for this is the fact that Nagios always has to take the
initiative to poll a client. &nbsp;This is in Nagios terminology called an
active check. &nbsp;It's of course normal that a client receives instructions
on what it needs to do like which plugin to execute or which thresholds
to evaluate. &nbsp;However, if you think about it, why do we have to repeat
the same question over and over again while in essence nothing has ever
changed between the current and the previous request? Isn't it normal we
ask a question once and say report back at this interval and carry on
until further notice?</p>
<p>So why not offloading all (or most of) the scheduling effort a central
monitoring system has to perform to the monitoring clients running on
your hosts?</p>
<p>If you would take it further, you could turn each of my monitoring
clients into an &quot;independent miniature monitoring engine&quot;. &nbsp;This way you
could shift the load from a central system to the collective of clients
in the network. &nbsp;This basically results in horizontal scalability and a
decentralized setup.</p>
</div>
<div class="section" id="requirements">
<h2>Requirements</h2>
<div class="section" id="open-and-rich-data-format">
<h3>Open and rich data format</h3>
<p>All in- and outgoing communication should be done in an clear and open
data format, which offers the flexibility to transform it into any
other&nbsp;desirable format which allows you to integrate the client with an
existing&nbsp;platform but which in its turn also allows you to move away
from it. &nbsp;All <a class="reference external" href="http://wiki.smetj.net/wiki/Moncli_documentation#Request">incoming</a>&nbsp;to and <a class="reference external" href="http://wiki.smetj.net/wiki/Moncli_documentation#Reports">outgoing</a>&nbsp;data from Moncli is in JSON
format. This makes sure that Moncli data is manipulated easily.</p>
</div>
<div class="section" id="scheduling">
<h3>Scheduling</h3>
<p>As said, the client needs to be able to schedule a request at an
<a class="reference external" href="http://wiki.smetj.net/wiki/Moncli_documentation#cycle">interval of choice</a>. When the client restarts, it should remember its
scheduled requests and carry on from the moment it's alive again. Moncli
has a build in scheduler which <a class="reference external" href="http://wiki.smetj.net/wiki/Moncli_documentation#cache">writes its schedule to disk</a>.</p>
</div>
<div class="section" id="flexible-messaging">
<h3>Flexible messaging.</h3>
<p>Since Moncli has its own scheduler, it has to submit the check results
somehow in a trustworthy way without actually having to care much about
who consumes the data when and where. Moncli submits check results into
the <a class="reference external" href="http://www.rabbitmq.com/">RabbitMQ</a> message broker, which offers a great deal of
flexibility.</p>
<p>Moncli <a class="reference external" href="http://wiki.smetj.net/wiki/Moncli_documentation#Communication">listens</a> on the message broker infrastructure for incoming
requests. Each Moncli client registers a queue using its FQDN as a name
on the message broker infrastructure from where it receives the requests
it should execute.</p>
</div>
<div class="section" id="simple-manageable-but-safe-plugin-design">
<h3>Simple, manageable but safe plugin design</h3>
<p>Metrics have to come from somewhere. When Moncli executes a request, it
actually executes a locally stored plugin. <a class="reference external" href="http://wiki.smetj.net/wiki/Moncli_documentation#Plugins">All this plugin needs to do
is create a list of key/value pairs</a>. This significantly lowers the
difficulty and time required to create new plugins which also allows
less experienced people to write plugins. Moncli will only execute
<a class="reference external" href="http://wiki.smetj.net/wiki/Moncli_documentation#local_repo">locally stored plugins</a> which have a hash which matches the one in the
request. When a plugin with such a hash isn't found locally, it will try
to download an update or new version from <a class="reference external" href="http://wiki.smetj.net/wiki/Moncli_documentation#remote_repo">a central location</a>.</p>
</div>
<div class="section" id="evaluation-of-metrics">
<h3>Evaluation of metrics</h3>
<p>Nagios plugins require you to build in the evaluation of thresholds in
them by feeding the plugin the warning and critical values. &nbsp;Moncli also
performs the evaluation of metrics on the client side but takes another
approach. &nbsp;Instead of doing threshold evaluation in the plugin, Moncli
does the evaluation itself, based upon the <a class="reference external" href="http://wiki.smetj.net/wiki/Moncli_documentation#thresholds">thresholds</a> one provides in
combination with a an evaluator.</p>
<p>There are currently 2 <a class="reference external" href="http://wiki.smetj.net/wiki/Moncli_documentation#Evaluator_definitions">types of evaluators</a> (more planned):</p>
<p>Formulas: calculations using the keys/values returned by the plugin.
Regexes: Simple regex matching on the output of a plugin (not key
value pairs)</p>
<p>It's optional to define evaluators in a request. &nbsp;In this case, Moncli
just becomes a metrics collector.</p>
<p>A good starting point to figure out what the possibilities of Moncli are
is done by looking through &nbsp;the in- and outgoing data format of Moncli
called <a class="reference external" href="http://wiki.smetj.net/wiki/Moncli_documentation#Request">requests</a> and <a class="reference external" href="http://wiki.smetj.net/wiki/Moncli_documentation#Reports">reports</a>.</p>
<p>A second post will be about consuming and processing of Moncli data from
RabbitMQ.</p>
</div>
</div>

            </div>
            <!-- /.entry-content -->
    <hr />
    <section class="comments" id="comments">
        <h2>Comments</h2>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'smetj'; // required: replace example with your forum shortname
            var disqus_identifier = 'moncli-an-introduction';
            var disqus_url = 'http://smetj.net/moncli-an-introduction.html';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-lg-3 well well-sm" id="sidebar">

<aside>
    <section>
        <ul class="list-group list-group-flush">
                <li class="list-group-item"><h4><i class="icon-home icon-large"></i>Social</h4></li>
                    <li class="list-group-item"><a href="http://twitter.com/smetj"><i
                            class="icon-twitter-sign icon-large"></i>twitter
                    </a></li>
                    <li class="list-group-item"><a href="http://github.com/smetj"><i
                            class="icon-github-sign icon-large"></i>github
                    </a></li>



                <li class="list-group-item"><a href="http://smetj.net/tags.html"><h4><i class="icon-tags icon-large"></i>Tags</h4></a></li>
                        <li class="list-group-item tag-1">
                            <a href="http://smetj.net/tag/moncli.html">
                                moncli
                            </a>
                        </li>
                        <li class="list-group-item tag-1">
                            <a href="http://smetj.net/tag/graphite.html">
                                graphite
                            </a>
                        </li>
                        <li class="list-group-item tag-1">
                            <a href="http://smetj.net/tag/metricfactory.html">
                                metricfactory
                            </a>
                        </li>
                        <li class="list-group-item tag-1">
                            <a href="http://smetj.net/tag/python.html">
                                python
                            </a>
                        </li>
                        <li class="list-group-item tag-1">
                            <a href="http://smetj.net/tag/monitoringlove.html">
                                monitoringlove
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://smetj.net/tag/wishbone.html">
                                wishbone
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://smetj.net/tag/metrics.html">
                                metrics
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://smetj.net/tag/rabbitmq.html">
                                rabbitmq
                            </a>
                        </li>
                        <li class="list-group-item tag-3">
                            <a href="http://smetj.net/tag/monitoring.html">
                                monitoring
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://smetj.net/tag/krolyk.html">
                                krolyk
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://smetj.net/tag/elasticsearch.html">
                                elasticsearch
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://smetj.net/tag/nagios.html">
                                nagios
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://smetj.net/tag/pypy.html">
                                pypy
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://smetj.net/tag/company.html">
                                company
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://smetj.net/tag/messaging.html">
                                messaging
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://smetj.net/tag/tools.html">
                                tools
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://smetj.net/tag/gevent.html">
                                gevent
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://smetj.net/tag/amqp.html">
                                amqp
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://smetj.net/tag/events.html">
                                events
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://smetj.net/tag/molog.html">
                                molog
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://smetj.net/tag/mod_gearman.html">
                                mod_gearman
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://smetj.net/tag/mqtt.html">
                                mqtt
                            </a>
                        </li>
        </ul>
    </section>


    <section>
    <ul class="list-group list-group-flush">
    <li class="list-group-item"><h4><i class="icon-github icon-large"></i>GitHub Repos</h4></li>
        <div id="gh_repos">
            <p class="list-group-item">Status updating...</p>
        </div>
    </ul>
        <script type="text/javascript">
            $(document).ready(function () {
                if (!window.jXHR) {
                    var jxhr = document.createElement('script');
                    jxhr.type = 'text/javascript';
                    jxhr.src = 'http://smetj.net/theme/js/jXHR.js';
                    var s = document.getElementsByTagName('script')[0];
                    s.parentNode.insertBefore(jxhr, s);
                }

                github.showRepos({
                    user: 'smetj',
                    count: 5,
                    skip_forks: false,
                    target: '#gh_repos'
                });
            });
        </script>
        <script src="http://smetj.net/theme/js/github.js" type="text/javascript"></script>
    </section>
</aside>        </div>
    </div>
</div>
<footer>
    <div class="container">
        <hr>
        <p class="pull-right"><i class="icon-arrow-up"></i> <a href="#">Back to top</a></p>


        <p>&copy; 2013 Jelle Smet &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a></p>
    </div>
</footer>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://smetj.net/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://smetj.net/theme/js/respond.min.js"></script>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'smetj'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>


</body>
</html>