<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">
<head>
    <title>Consuming Moncli data from RabbitMQ using Krolyk</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Open Graph tags -->

            <meta property="og:type" content="article"/>
            <meta property="og:title" content="Consuming Moncli data from RabbitMQ using Krolyk"/>
            <meta property="og:url" content="http://smetj.net/consuming-moncli-data-from-rabbitmq-using-krolyk.html"/>
            <meta property="og:description" content="What's in a name? Before we go into more detail on how to execute plugins, manipulate and evaluate data with Moncli we first have to take a look how we are going to consume the data produced by Moncli from RabbitMQ. Â I found myself quite often in the situation ..."/>

    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://smetj.net/theme/css/bootstrap.flatly.min.css" type="text/css"/>
    <link href="http://smetj.net/theme/css/font-awesome.min.css" rel="stylesheet">
    <link href="http://smetj.net/theme/css/pygments.css" rel="stylesheet">
    <link rel="stylesheet" href="http://smetj.net/theme/css/style.css" type="text/css"/>
    <!-- JavaScript plugins (requires jQuery) -->
    <script src="http://code.jquery.com/jquery.js"></script>


    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-40703057-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();

    </script>
</head>
<body>
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://smetj.net" class="navbar-brand">Project site of Jelle Smet</a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                        <li >
                            <a href="http://smetj.net/category/development.html">Development</a>
                        </li>
                        <li class="active">
                            <a href="http://smetj.net/category/engineering.html">Engineering</a>
                        </li>
                        <li >
                            <a href="http://smetj.net/category/misc.html">Misc</a>
                        </li>
                        <li >
                            <a href="http://smetj.net/category/monitoringlove.html">#monitoringlove</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="http://smetj.net/archives.html"><i class="icon-th-list"></i>Archives</a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</nav>
<!-- /.navbar -->
<div class="container">
    <div class="row">
        <div class="col-lg-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://smetj.net/consuming-moncli-data-from-rabbitmq-using-krolyk.html"
                       rel="bookmark"
                       title="Permalink to Consuming Moncli data from RabbitMQ using Krolyk">
                        Consuming Moncli data from RabbitMQ using Krolyk
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="icon-calendar"></i>za 11 februari 2012
    </span>



<span class="label label-default">Tags</span>
	<a href="http://smetj.net/tag/krolyk.html">krolyk</a>
        /
	<a href="http://smetj.net/tag/moncli.html">moncli</a>
        /
	<a href="http://smetj.net/tag/monitoringlove.html">monitoringlove</a>
        /
	<a href="http://smetj.net/tag/rabbitmq.html">rabbitmq</a>
</footer><!-- /.post-info -->                    </div>
                </div>
                <div class="section" id="what-s-in-a-name">
<h2>What's in a name?</h2>
<p>Before we go into more detail on how to execute plugins,
manipulate and evaluate data with Moncli we first have to take a look
how we are going to consume the data produced by Moncli from RabbitMQ.
&nbsp;I found myself quite often in the situation where I had to write again
and again a daemon or process which consumes data from RabbitMQ and do
something with it. &nbsp;I already started to write <a class="reference external" href="https://github.com/smetj/krolyk">Krolyk</a>&nbsp;which initial
goal was to consume Nagios passive check results from RabbitMQ and write
them into the Nagios command pipe. &nbsp;I found that too specific, so I
changed Krolyk into a more <a class="reference external" href="https://github.com/smetj/krolyk/tree/master/lib/plugins">modular or plugin system</a>, which allows you
to write a <a class="reference external" href="https://github.com/smetj/krolyk/blob/master/lib/plugins/skeleton.py">simple Python class</a> which consumes data from RabbitMQ.
&nbsp;The nice thing about it is when you write a plugin for Krolyk, it will
start one or more &nbsp;parallel consumers without you having to worry about
how to organize all that. &nbsp;This makes writing consumers for RabbitMQ
easy and accessible to more people. &nbsp;Krolyk's use is however <strong>not</strong>limited to the monitoring and metrics collection scope. &nbsp;It's intended
to be generic, allowing one to easily write parallel RabbitMQ consumers.</p>
<p>Consuming Moncli data from RabbitMQ</p>
<p>So let's setup Krolyk to consume and simply display data produced by
Moncli.</p>
<p>To realize this we can use the <a class="reference external" href="https://github.com/smetj/krolyk/blob/master/lib/plugins/skeleton.py">skeleton.py</a> plugin. &nbsp;The <em>skeleton</em>
plugin can be used as a base for your new and more complex plugins.
&nbsp;What skeleton does out of the box is just print the content it consumes
from the broker to stdout and acknowledge it back to the broker so it's
removed from the queue. &nbsp;Just have a look at the <em>consume</em> function.
&nbsp;This should pretty much give you an idea of what you can do with it.</p>
</div>
<div class="section" id="configuration">
<h2>Configuration</h2>
<p>Krolyk has a config file in which you can define parameters to connect
to RabbitMQ and parameters which are available to the plugin you write.
&nbsp;If we take a look at krolyk.cfg we can see under the [&quot;plugins&quot;]
section a configuration section for each individual plugin. &nbsp;You have to
make sure that the name of the plugin section is exactly the same
(including case) as the name of your class.</p>
<pre class="literal-block">
[ccnbw_ini width=&quot;500&quot; lines=&quot;-1&quot; ]
[ &quot;plugins&quot; ]
    [[ &quot;Skeleton&quot; ]]
        &quot;_enabled&quot;       = False
        &quot;_workers&quot;       = 5
        &quot;_broker&quot;        = &quot;sandbox&quot;
        &quot;_queue&quot;         = &quot;moncli_reports&quot;
        &quot;_user&quot;          = &quot;guest&quot;
        &quot;_password&quot;      = &quot;guest&quot;
        &quot;blah1&quot;          = &quot;whatever&quot;
        &quot;fu&quot;             = &quot;bar&quot;
[/ccnbw_ini]
</pre>
<p>Each plugin/class should have at minimal the parameters defined required
to &nbsp;connect to the RabbitMQ broker. &nbsp;These parameters all start with an
underscore. &nbsp;All other variables you define will be available to your
class as a dictionary called &quot;self.configuration&quot;</p>
</div>
<div class="section" id="a-practical-example">
<h2>A practical example</h2>
<p>So let's start an instance of Krolyk which consumes data produced by
Moncli and prints it to stdout. &nbsp;Keep in mind Krolyk that if the queue
doesn't exist, Krolyk will create a durable one for you.</p>
<ol class="arabic">
<li><p class="first">Start Krolyk in the foreground with a config file which works for
your environment:</p>
<pre class="literal-block">
jelle&#64;indigo:~$ /opt/krolyk/bin/krolyk debug --config /opt/krolyk/etc/krolyk.cfg
</pre>
</li>
<li><p class="first">Submit a test string to the AMQP default exchange:<a class="reference external" href="http://smetj.net/2012/02/11/consuming-moncli-data-from-rabbitmq-using-krolyk/krolyk_rabbit1/"><img alt="image1" src="http://smetj.net/wp-content/uploads/2012/02/krolyk_rabbit1-150x150.jpg" /></a></p>
</li>
<li><p class="first">And see it appear on the command line:<a class="reference external" href="http://smetj.net/2012/02/11/consuming-moncli-data-from-rabbitmq-using-krolyk/krolyk_rabbit2/"><img alt="image2" src="http://smetj.net/wp-content/uploads/2012/02/krolyk_rabbit2-300x91.jpg" /></a></p>
</li>
</ol>
<p>This example isn't really doing anything exciting but, I at least it
gives you an idea on what functionality Krolyk offers. &nbsp;Using the
information from this post you should be able to display the data
generated by Moncli, so you have an idea what comes out of it.</p>
<p>In the next post we will be creating Requests and Reports with Moncli.</p>
</div>

            </div>
            <!-- /.entry-content -->
    <hr />
    <section class="comments" id="comments">
        <h2>Comments</h2>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'smetj'; // required: replace example with your forum shortname
            var disqus_identifier = 'consuming-moncli-data-from-rabbitmq-using-krolyk';
            var disqus_url = 'http://smetj.net/consuming-moncli-data-from-rabbitmq-using-krolyk.html';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-lg-3 well well-sm" id="sidebar">

<aside>
    <section>
        <ul class="list-group list-group-flush">
                <li class="list-group-item"><h4><i class="icon-home icon-large"></i>Social</h4></li>
                    <li class="list-group-item"><a href="http://twitter.com/smetj"><i
                            class="icon-twitter-sign icon-large"></i>twitter
                    </a></li>
                    <li class="list-group-item"><a href="http://github.com/smetj"><i
                            class="icon-github-sign icon-large"></i>github
                    </a></li>



                <li class="list-group-item"><a href="http://smetj.net/tags.html"><h4><i class="icon-tags icon-large"></i>Tags</h4></a></li>
                        <li class="list-group-item tag-1">
                            <a href="http://smetj.net/tag/moncli.html">
                                moncli
                            </a>
                        </li>
                        <li class="list-group-item tag-1">
                            <a href="http://smetj.net/tag/graphite.html">
                                graphite
                            </a>
                        </li>
                        <li class="list-group-item tag-1">
                            <a href="http://smetj.net/tag/monitoringlove.html">
                                monitoringlove
                            </a>
                        </li>
                        <li class="list-group-item tag-1">
                            <a href="http://smetj.net/tag/python.html">
                                python
                            </a>
                        </li>
                        <li class="list-group-item tag-1">
                            <a href="http://smetj.net/tag/metricfactory.html">
                                metricfactory
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://smetj.net/tag/rabbitmq.html">
                                rabbitmq
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://smetj.net/tag/wishbone.html">
                                wishbone
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://smetj.net/tag/metrics.html">
                                metrics
                            </a>
                        </li>
                        <li class="list-group-item tag-3">
                            <a href="http://smetj.net/tag/monitoring.html">
                                monitoring
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://smetj.net/tag/events.html">
                                events
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://smetj.net/tag/mod_gearman.html">
                                mod_gearman
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://smetj.net/tag/mqtt.html">
                                mqtt
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://smetj.net/tag/company.html">
                                company
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://smetj.net/tag/gevent.html">
                                gevent
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://smetj.net/tag/krolyk.html">
                                krolyk
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://smetj.net/tag/nagios.html">
                                nagios
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://smetj.net/tag/amqp.html">
                                amqp
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://smetj.net/tag/tools.html">
                                tools
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://smetj.net/tag/molog.html">
                                molog
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://smetj.net/tag/pypy.html">
                                pypy
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://smetj.net/tag/messaging.html">
                                messaging
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://smetj.net/tag/elasticsearch.html">
                                elasticsearch
                            </a>
                        </li>
        </ul>
    </section>


    <section>
    <ul class="list-group list-group-flush">
    <li class="list-group-item"><h4><i class="icon-github icon-large"></i>GitHub Repos</h4></li>
        <div id="gh_repos">
            <p class="list-group-item">Status updating...</p>
        </div>
    </ul>
        <script type="text/javascript">
            $(document).ready(function () {
                if (!window.jXHR) {
                    var jxhr = document.createElement('script');
                    jxhr.type = 'text/javascript';
                    jxhr.src = 'http://smetj.net/theme/js/jXHR.js';
                    var s = document.getElementsByTagName('script')[0];
                    s.parentNode.insertBefore(jxhr, s);
                }

                github.showRepos({
                    user: 'smetj',
                    count: 5,
                    skip_forks: false,
                    target: '#gh_repos'
                });
            });
        </script>
        <script src="http://smetj.net/theme/js/github.js" type="text/javascript"></script>
    </section>
</aside>        </div>
    </div>
</div>
<footer>
    <div class="container">
        <hr>
        <p class="pull-right"><i class="icon-arrow-up"></i> <a href="#">Back to top</a></p>


        <p>&copy; 2013 Jelle Smet &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a></p>
    </div>
</footer>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://smetj.net/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://smetj.net/theme/js/respond.min.js"></script>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'smetj'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>


</body>
</html>