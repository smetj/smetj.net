<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Consuming Moncli data from RabbitMQ using Krolyk</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Jelle Smet">

    <!-- Le styles -->
    <link rel="stylesheet" href="file:///home/smetj/projects/github/smetj.net/output/theme/css/bootstrap.min.css" type="text/css" />
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
      .tag-1 {
        font-size: 13pt;
      }
      .tag-2 {
        font-size: 10pt;
      }
      .tag-2 {
        font-size: 8pt;
      }
      .tag-4 {
        font-size: 6pt;
     }
    </style>
    <link href="file:///home/smetj/projects/github/smetj.net/output/theme/css/bootstrap-responsive.min.css" rel="stylesheet">
        <link href="file:///home/smetj/projects/github/smetj.net/output/theme/css/font-awesome.css" rel="stylesheet">

    <link href="file:///home/smetj/projects/github/smetj.net/output/theme/css/pygments.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="file:///home/smetj/projects/github/smetj.net/output/theme/images/favicon.ico">
    <link rel="apple-touch-icon" href="file:///home/smetj/projects/github/smetj.net/output/theme/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="file:///home/smetj/projects/github/smetj.net/output/theme/images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="file:///home/smetj/projects/github/smetj.net/output/theme/images/apple-touch-icon-114x114.png">

    <link href="file:///home/smetj/projects/github/smetj.net/output/" type="application/atom+xml" rel="alternate" title="smetj.net ATOM Feed" />

  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="file:///home/smetj/projects/github/smetj.net/output/index.html">smetj.net </a>
          <div class="nav-collapse">
            <ul class="nav">
                          <li class="divider-vertical"></li>
                  <li >
                    <a href="file:///home/smetj/projects/github/smetj.net/output/category/development.html">
						<i class="icon-folder-open icon-large"></i>development
					</a>
                  </li>
                  <li class="active">
                    <a href="file:///home/smetj/projects/github/smetj.net/output/category/events.html">
						<i class="icon-folder-open icon-large"></i>events
					</a>
                  </li>
                  <li >
                    <a href="file:///home/smetj/projects/github/smetj.net/output/category/misc.html">
						<i class="icon-folder-open icon-large"></i>misc
					</a>
                  </li>
                  <li >
                    <a href="file:///home/smetj/projects/github/smetj.net/output/category/monitoringlove.html">
						<i class="icon-folder-open icon-large"></i>#monitoringlove
					</a>
                  </li>

                          <ul class="nav pull-right">
                                <li><a href="file:///home/smetj/projects/github/smetj.net/output/archives.html"><i class="icon-th-list"></i>Archives</a></li>
                          </ul>

            </ul>
            <!--<p class="navbar-text pull-right">Logged in as <a href="#">username</a></p>-->
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="row">
        <div class="span9" id="content">
<section id="content">
        <article>
                <header>
                        <h1>
                                <a href=""
                                        rel="bookmark"
                                        title="Permalink to Consuming Moncli data from RabbitMQ using Krolyk">
                                        Consuming Moncli data from RabbitMQ using Krolyk
                                </a>
                        </h1>
                </header>
                <div class="entry-content">
                <div class="well">
<footer class="post-info">
<span class="label">Date</span>
<abbr class="published" title="2012-02-11T18:08:00">
        <i class="icon-calendar"></i>Sat 11 February 2012
</abbr>
<span class="label">By</span>
<a href="file:///home/smetj/projects/github/smetj.net/output/author/smetj.html"><i class="icon-user"></i>smetj</a>
<span class="label">Category</span>
<a href="file:///home/smetj/projects/github/smetj.net/output/category/events.html"><i class="icon-folder-open"></i>events</a>.


<span class="label">Tags</span>
	<a href="file:///home/smetj/projects/github/smetj.net/output/tag/krolyk.html"><i class="icon-tag"></i>krolyk</a>
	<a href="file:///home/smetj/projects/github/smetj.net/output/tag/moncli.html"><i class="icon-tag"></i>moncli</a>
	<a href="file:///home/smetj/projects/github/smetj.net/output/tag/monitoringlove.html"><i class="icon-tag"></i>monitoringlove</a>
	<a href="file:///home/smetj/projects/github/smetj.net/output/tag/rabbitmq.html"><i class="icon-tag"></i>rabbitmq</a>
</footer><!-- /.post-info -->                </div>
                <div class="section" id="what-s-in-a-name">
<h2>What's in a name?</h2>
<p><a class="reference external" href="http://smetj.net/2012/02/11/consuming-moncli-data-from-rabbitmq-using-krolyk/krolyk-2/"><img alt="image0" src="http://smetj.net/wp-content/uploads/2012/02/Krolyk-300x185.jpg" /></a>Before we go into more detail on how to execute plugins,
manipulate and evaluate data with Moncli we first have to take a look
how we are going to consume the data produced by Moncli from RabbitMQ.
&nbsp;I found myself quite often in the situation where I had to write again
and again a daemon or process which consumes data from RabbitMQ and do
something with it. &nbsp;I already started to write <a class="reference external" href="https://github.com/smetj/krolyk">Krolyk</a>&nbsp;which initial
goal was to consume Nagios passive check results from RabbitMQ and write
them into the Nagios command pipe. &nbsp;I found that too specific, so I
changed Krolyk into a more <a class="reference external" href="https://github.com/smetj/krolyk/tree/master/lib/plugins">modular or plugin system</a>, which allows you
to write a <a class="reference external" href="https://github.com/smetj/krolyk/blob/master/lib/plugins/skeleton.py">simple Python class</a> which consumes data from RabbitMQ.
&nbsp;The nice thing about it is when you write a plugin for Krolyk, it will
start one or more &nbsp;parallel consumers without you having to worry about
how to organize all that. &nbsp;This makes writing consumers for RabbitMQ
easy and accessible to more people. &nbsp;Krolyk's use is however <strong>not</strong>limited to the monitoring and metrics collection scope. &nbsp;It's intended
to be generic, allowing one to easily write parallel RabbitMQ consumers.</p>
<p>Consuming Moncli data from RabbitMQ</p>
<p>So let's setup Krolyk to consume and simply display data produced by
Moncli.</p>
<p>To realize this we can use the <a class="reference external" href="https://github.com/smetj/krolyk/blob/master/lib/plugins/skeleton.py">skeleton.py</a> plugin. &nbsp;The <em>skeleton</em>
plugin can be used as a base for your new and more complex plugins.
&nbsp;What skeleton does out of the box is just print the content it consumes
from the broker to stdout and acknowledge it back to the broker so it's
removed from the queue. &nbsp;Just have a look at the <em>consume</em> function.
&nbsp;This should pretty much give you an idea of what you can do with it.</p>
</div>
<div class="section" id="configuration">
<h2>Configuration</h2>
<p>Krolyk has a config file in which you can define parameters to connect
to RabbitMQ and parameters which are available to the plugin you write.
&nbsp;If we take a look at krolyk.cfg we can see under the [&quot;plugins&quot;]
section a configuration section for each individual plugin. &nbsp;You have to
make sure that the name of the plugin section is exactly the same
(including case) as the name of your class.</p>
<pre class="literal-block">
[ccnbw_ini width=&quot;500&quot; lines=&quot;-1&quot; ]
[ &quot;plugins&quot; ]
    [[ &quot;Skeleton&quot; ]]
        &quot;_enabled&quot;       = False
        &quot;_workers&quot;       = 5
        &quot;_broker&quot;        = &quot;sandbox&quot;
        &quot;_queue&quot;         = &quot;moncli_reports&quot;
        &quot;_user&quot;          = &quot;guest&quot;
        &quot;_password&quot;      = &quot;guest&quot;
        &quot;blah1&quot;          = &quot;whatever&quot;
        &quot;fu&quot;             = &quot;bar&quot;
[/ccnbw_ini]
</pre>
<p>Each plugin/class should have at minimal the parameters defined required
to &nbsp;connect to the RabbitMQ broker. &nbsp;These parameters all start with an
underscore. &nbsp;All other variables you define will be available to your
class as a dictionary called &quot;self.configuration&quot;</p>
</div>
<div class="section" id="a-practical-example">
<h2>A practical example</h2>
<p>So let's start an instance of Krolyk which consumes data produced by
Moncli and prints it to stdout. &nbsp;Keep in mind Krolyk that if the queue
doesn't exist, Krolyk will create a durable one for you.</p>
<ol class="arabic">
<li><p class="first">Start Krolyk in the foreground with a config file which works for
your environment:</p>
<pre class="literal-block">
jelle&#64;indigo:~$ /opt/krolyk/bin/krolyk debug --config /opt/krolyk/etc/krolyk.cfg
</pre>
</li>
<li><p class="first">Submit a test string to the AMQP default exchange:<a class="reference external" href="http://smetj.net/2012/02/11/consuming-moncli-data-from-rabbitmq-using-krolyk/krolyk_rabbit1/"><img alt="image1" src="http://smetj.net/wp-content/uploads/2012/02/krolyk_rabbit1-150x150.jpg" /></a></p>
</li>
<li><p class="first">And see it appear on the command line:<a class="reference external" href="http://smetj.net/2012/02/11/consuming-moncli-data-from-rabbitmq-using-krolyk/krolyk_rabbit2/"><img alt="image2" src="http://smetj.net/wp-content/uploads/2012/02/krolyk_rabbit2-300x91.jpg" /></a></p>
</li>
</ol>
<p>This example isn't really doing anything exciting but, I at least it
gives you an idea on what functionality Krolyk offers. &nbsp;Using the
information from this post you should be able to display the data
generated by Moncli, so you have an idea what comes out of it.</p>
<p>In the next post we will be creating Requests and Reports with Moncli.</p>
</div>

                </div><!-- /.entry-content -->
                <div class="comments">
                <h2>Comments !</h2>
                        <div id="disqus_thread"></div>
                        <script type="text/javascript">
                           var disqus_identifier = "consuming-moncli-data-from-rabbitmq-using-krolyk.html";
                           (function() {
                                var dsq = document.createElement('script');
                                dsq.type = 'text/javascript'; dsq.async = true;
                                dsq.src = 'http://smetj.disqus.com/embed.js';
                                (document.getElementsByTagName('head')[0] ||
                                 document.getElementsByTagName('body')[0]).appendChild(dsq);
                          })();
                        </script>
                </div>
        </article>
</section>
        </div><!--/span-->

                <div class="span3 well sidebar-nav" id="sidebar">
<ul class="nav nav-list">
<li class="nav-header"><h4><i class="icon-home icon-large"></i> social</h4></li>
    <li><a href="http://twitter.com/smetj"><i class="icon-twitter-sign icon-large"></i>twitter</a></li>
    <li><a href="http://github.com/smetj"><i class="icon-github-sign icon-large"></i>github</a></li>

<li class="nav-header"><h4><i class="icon-folder-close icon-large"></i>Categories</h4></li>
<li>
<a href="file:///home/smetj/projects/github/smetj.net/output/category/development.html">
    <i class="icon-folder-open icon-large"></i>development
</a>
</li>
<li>
<a href="file:///home/smetj/projects/github/smetj.net/output/category/events.html">
    <i class="icon-folder-open icon-large"></i>events
</a>
</li>
<li>
<a href="file:///home/smetj/projects/github/smetj.net/output/category/misc.html">
    <i class="icon-folder-open icon-large"></i>misc
</a>
</li>
<li>
<a href="file:///home/smetj/projects/github/smetj.net/output/category/monitoringlove.html">
    <i class="icon-folder-open icon-large"></i>#monitoringlove
</a>
</li>

<li class="nav-header"><h4><i class="icon-tags icon-large"></i>Tags</h4></li>
<li class="tag-2">
    <a href="file:///home/smetj/projects/github/smetj.net/output/tag/monitoring.html">
        <i class="icon-tag icon-large"></i>monitoring
    </a>
</li>
<li class="tag-2">
    <a href="file:///home/smetj/projects/github/smetj.net/output/tag/metricfactory.html">
        <i class="icon-tag icon-large"></i>metricfactory
    </a>
</li>
<li class="tag-4">
    <a href="file:///home/smetj/projects/github/smetj.net/output/tag/amqp.html">
        <i class="icon-tag icon-large"></i>amqp
    </a>
</li>
<li class="tag-4">
    <a href="file:///home/smetj/projects/github/smetj.net/output/tag/pypy.html">
        <i class="icon-tag icon-large"></i>pypy
    </a>
</li>
<li class="tag-4">
    <a href="file:///home/smetj/projects/github/smetj.net/output/tag/metrics.html">
        <i class="icon-tag icon-large"></i>metrics
    </a>
</li>
<li class="tag-4">
    <a href="file:///home/smetj/projects/github/smetj.net/output/tag/krolyk.html">
        <i class="icon-tag icon-large"></i>krolyk
    </a>
</li>
<li class="tag-4">
    <a href="file:///home/smetj/projects/github/smetj.net/output/tag/company.html">
        <i class="icon-tag icon-large"></i>company
    </a>
</li>
<li class="tag-4">
    <a href="file:///home/smetj/projects/github/smetj.net/output/tag/tools.html">
        <i class="icon-tag icon-large"></i>tools
    </a>
</li>
<li class="tag-4">
    <a href="file:///home/smetj/projects/github/smetj.net/output/tag/gevent.html">
        <i class="icon-tag icon-large"></i>gevent
    </a>
</li>
<li class="tag-2">
    <a href="file:///home/smetj/projects/github/smetj.net/output/tag/rabbitmq.html">
        <i class="icon-tag icon-large"></i>rabbitmq
    </a>
</li>
<li class="tag-2">
    <a href="file:///home/smetj/projects/github/smetj.net/output/tag/graphite.html">
        <i class="icon-tag icon-large"></i>graphite
    </a>
</li>
<li class="tag-4">
    <a href="file:///home/smetj/projects/github/smetj.net/output/tag/molog.html">
        <i class="icon-tag icon-large"></i>molog
    </a>
</li>
<li class="tag-4">
    <a href="file:///home/smetj/projects/github/smetj.net/output/tag/wishbone.html">
        <i class="icon-tag icon-large"></i>wishbone
    </a>
</li>
<li class="tag-2">
    <a href="file:///home/smetj/projects/github/smetj.net/output/tag/python.html">
        <i class="icon-tag icon-large"></i>python
    </a>
</li>
<li class="tag-1">
    <a href="file:///home/smetj/projects/github/smetj.net/output/tag/monitoringlove.html">
        <i class="icon-tag icon-large"></i>monitoringlove
    </a>
</li>
<li class="tag-0">
    <a href="file:///home/smetj/projects/github/smetj.net/output/tag/moncli.html">
        <i class="icon-tag icon-large"></i>moncli
    </a>
</li>


</ul>        </div><!--/.well -->

      </div><!--/row-->

      <hr>

      <footer>
        <address id="about">
                Proudly powered by <a href="http://pelican.notmyidea.org/">Pelican <i class="icon-external-link"></i></a>,
                                which takes great advantage of <a href="http://python.org">Python <i class="icon-external-link"></i></a>.
        </address><!-- /#about -->

        <p>The theme is from <a href="http://twitter.github.com/bootstrap/">Bootstrap from Twitter <i class="icon-external-link"></i></a>,
                   and <a href="http://fortawesome.github.com/Font-Awesome/">Font-Awesome <i class="icon-external-link"></i></a>, thanks!</p>
      </footer>

    </div><!--/.fluid-container-->


<script type="text/javascript">
    var disqus_shortname = 'smetj';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

    <!-- Le javascript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="file:///home/smetj/projects/github/smetj.net/output/theme/js/jquery-1.7.2.min.js"></script>
    <script src="file:///home/smetj/projects/github/smetj.net/output/theme/js/bootstrap.min.js"></script>
  </body>
</html>